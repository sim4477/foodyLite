{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard - Food Delivery App{% endblock %}

{% block content %}
<div class="dashboard-header">
    <div class="row">
        <div class="col-12">
            <h1>Welcome, {{ user.mobile_number }}!</h1>
            <p class="lead">Role: <span class="badge bg-primary">
                {% if user.role == 'customer' %}👤{% elif user.role == 'delivery_partner' %}🚚{% elif user.role == 'admin' %}👨‍💼{% else %}👤{% endif %}
                {{ user.get_role_display }}
            </span></p>
        </div>
    </div>
</div>

<div class="row">
    {% if user.role == 'customer' %}
    <div class="col-md-6">
        <div class="dashboard-card">
            <h5>📝 New Booking</h5>
            <p>Create a new food delivery booking</p>
            <a href="/booking/create/" class="btn btn-primary">Create Booking</a>
        </div>
    </div>
    <div class="col-md-6">
        <div class="dashboard-card">
            <h5>📋 My Bookings</h5>
            <p>View all your bookings</p>
            <a href="/booking/" class="btn btn-primary">View Bookings</a>
        </div>
    </div>
    {% elif user.role == 'delivery_partner' %}
    <div class="col-md-6">
        <div class="dashboard-card">
            <h5>📦 My Deliveries                </h5>
                <p>View assigned deliveries</p>
                <a href="/booking/" class="btn btn-primary">View Deliveries</a>
        </div>
    </div>
    <div class="col-md-6">
        <div class="dashboard-card">
            <h5>💬 Chat                </h5>
                <p>Chat with customers</p>
                <a href="/booking/" class="btn btn-success">View Chats</a>
        </div>
    </div>
    {% elif user.role == 'admin' %}
    <div class="col-md-4">
        <div class="dashboard-card">
            <h5>📋 All Bookings                </h5>
                <p>View and manage all bookings</p>
                <a href="/booking/" class="btn btn-primary">Manage Bookings</a>
        </div>
    </div>
    <div class="col-md-4">
        <div class="dashboard-card">
            <h5>👥 Users                </h5>
                <p>Manage users and roles</p>
                <a href="/admin/" class="btn btn-secondary">Admin Panel</a>
        </div>
    </div>
    <div class="col-md-4">
        <div class="dashboard-card">
            <h5>📊 Analytics                </h5>
                <p>View system analytics</p>
                <a href="/booking/" class="btn btn-info">View Stats</a>
        </div>
    </div>
    {% endif %}
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="dashboard-card">
            <h5>📊 Quick Stats</h5>
                <div id="statsContainer">
                    {% if recent_bookings %}
                    <p>Recent Bookings: <strong>{{ recent_bookings|length }}</strong></p>
                    <p>Total Bookings: <strong>{{ total_bookings }}</strong></p>
                    {% else %}
                    <p>No bookings yet.</p>
                    {% endif %}
                </div>
        </div>
    </div>
</div>

{% if recent_bookings %}
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">📋 Recent Bookings</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Food Items</th>
                                <th>Status</th>
                                <th>Amount</th>
                                <th>Created</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for booking in recent_bookings %}
                            <tr>
                                <td>{{ booking.id }}</td>
                                <td>{{ booking.food_items|truncatechars:30 }}</td>
                                <td>
                                    <span class="badge 
                                        {% if booking.status == 'delivered' %}bg-success
                                        {% elif booking.status == 'cancelled' %}bg-danger
                                        {% elif booking.status == 'pending' %}bg-warning
                                        {% else %}bg-primary{% endif %}">
                                        {{ booking.get_status_display }}
                                    </span>
                                </td>
                                <td>₹{{ booking.total_amount }}</td>
                                <td>{{ booking.created_at|date:"M d, H:i" }}</td>
                                <td>
                                    <a href="/booking/{{ booking.id }}/" class="btn btn-sm btn-outline-primary">View</a>
                                    {% if booking.can_chat %}
                                    <a href="/chat/room/{{ booking.id }}/" class="btn btn-sm btn-outline-success">Chat</a>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}